<!DOCTYPE html>
<html>
<head>
    <title>Restaurant Search</title>
   
</head>
<body>
    <h1>Restaurant Search</h1>

    <form id="search-form">
        <label for="query">Search Query:</label>
        <input type="text" name="query" id="query" required>
        <br><br>

        <label for="location">Location (lat,lng):</label>
        <input type="text" name="location" id="location" required>
        <br><br>

        <label for="radius">Radius (meters):</label>
        <input type="number" name="radius" id="radius" value="3000">
        <br><br>

        <label for="min_rating">Minimum Rating:</label>
        <input type="number" step="0.1" name="min_rating" id="min_rating" value="0">
        <br><br>

        <button type="submit">Search</button>
    </form>

    <h2>Search Results:</h2>
    <div id="results"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('search-form').addEventListener('submit', function(event) {
                event.preventDefault(); 

                const query = document.getElementById('query').value;
                const location = document.getElementById('location').value;
                const radius = document.getElementById('radius').value;
                const min_rating = document.getElementById('min_rating').value;

                const params = new URLSearchParams({
                    query: query,
                    location: location,
                    radius: radius,
                    min_rating: min_rating
                });

                fetch(`/api/search_restaurants/?${params.toString()}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`Network response was not ok: ${response.statusText}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        const resultsDiv = document.getElementById('results');
                        resultsDiv.innerHTML = ''; // Clear previous results

                        if (data.error) {
                            resultsDiv.innerHTML = `<p style="color:red;">${data.error}</p>`;
                        } else {
                            const results = data.results;
                            if (results.length > 0) {
                                results.forEach(restaurant => {
                                    const restaurantDiv = document.createElement('div');
                                    restaurantDiv.innerHTML = `
                                        <strong>${restaurant.name}</strong><br>
                                        Rating: ${restaurant.rating}<br>
                                        Address: ${restaurant.address}<br>
                                        Place ID: ${restaurant.place_id}<br><br>
                                    `;
                                    resultsDiv.appendChild(restaurantDiv);
                                });
                            } else {
                                resultsDiv.innerHTML = '<p>No results found.</p>';
                            }
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching data:', error);
                        const resultsDiv = document.getElementById('results');
                        resultsDiv.innerHTML = `<p style="color:red;">An error occurred while fetching data.</p>`;
                    });
            });
        });
    </script>
</body>
</html>
